# Wait to find out

Откроем файл в IDA и перейдём в декомпилятор (клавиша *F5*). Проанализировав порядок, в котором происходит инициализация переменных, можно увидеть, что переменным **v16**, **v17**, **v18** и многим другим присваивается значение, зависящие от **v3** - она используется для хранения текущего времени.

![image](https://github.com/cybhack0/writeups-jeopardy-kxctf-2024-spring/assets/74200804/a64454ca-81ae-429c-8da1-713f2dd32a69)


В функцию **printf** передаются значения из двумерного массива. Индексы элементов массива зависят от переменной **v12**. Видим, что она, в свою очередь, зависит от переменных **v13** и **v11**. Результат **v13** косвенно связан с **v3** - через **v16**. Из этого можно заключить, что вывод программы зависит от времени, установленного на устройстве.

![v12](https://github.com/cybhack0/writeups-jeopardy-kxctf-2024-spring/assets/74200804/e7a69c5f-1c09-4e1d-b1ef-e186941f7d5e)


Одним из способов решений является написание скрипта, который будет менять время на системе и одновременно с этим запускать программу. Пример такого скрипта на Bash:
```bash
#!/bin/bash
for hour in {00..23}; do # Часы - от 00 до 23
  for minute in {00.59}; do # Минуты - от 00 до 59
    date --set "$hour:$minute" > /dev/null # Устанавливаем время, результат команды не выводим
    ./wait_to_find_out >> output.txt # Запускаем программы, вывод записываем в текстовый файл
  done
done
```
Проанализируем файл **output.txt**:
![output](https://github.com/cybhack0/writeups-jeopardy-kxctf-2024-spring/assets/74200804/72f61b28-68e1-4bc9-a692-07f4344b4229)

Можно предположить, что некоторые из встреченных строк закодированы с помощью Base64. Чтобы не проверять каждую строку вручную, напишем парсер на Python:
```python
import base64
with open('output.txt', 'r') as file:
  for line in file:
    if not line.startswith('You'): # Проверяем только нестандартные строки
      line = line.strip() # Убираем спецсимволы, если есть
      try: print(base64.b64decode(line).decode('utf-8')) # Декодируем и выводим в консоль
      except: pass # Пропускаем ошибки, если не получилось раскодировать
``` 

Результат работы парсера:

![parser](https://github.com/cybhack0/writeups-jeopardy-kxctf-2024-spring/assets/74200804/815b7eda-a19d-438f-bced-f15bfc5aa8f3)

Внутренняя часть флага получена. Оборачиваем в шаблон: **kxctf{X0R_0_CL0CK}**
